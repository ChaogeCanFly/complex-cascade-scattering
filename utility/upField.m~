function phi = upField(data,type)

s=data.spac(1); d=data.spac(2); del=data.spac(3);
sigma=data.sigma;
SQRTa=data.SQRTa;
M=data.M;
A1aResP = data.A1aResP.(type);
A1bResP = data.A1bResP.(type);
LPa = permute(data.LPa,[3,2,1,4,5]);

data.comb=[1,0,1,0];

%Ufin= pi*1i*sum(bsxfun(@times,permute(D(LPa,data),[3,2,1,4,5]),(A1aResP+A1bResP)),3);
Ufin= pi*1i*sum(bsxfun(@times,permute(D(LPa,data),[3,2,1,4,5]),(A1aResP+A1bResP)),3);

phi = @(zVar) pi/del*sum(SQRTa,3));

end